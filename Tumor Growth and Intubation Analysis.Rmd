---
title: "Tumor Growth and Intubation Analysis"
author: "Ally Tirendi"
output:
  html_document:
    df_print: paged
    toc: true
    number_sections: false
    toc_depth: '3'
    code_folding: show
---

```{r,echo=FALSE,message=FALSE,warning=FALSE}
# this is a set-up chunk
# DON'T CHANGE THESE SETTINGS--I'VE SET THEM UP TO MAKE THINGS RUN SMOOTHLY 
require(knitr)
try(knitr::opts_chunk$set(echo = TRUE, error = TRUE, 
                      root.dir = rprojroot::find_rstudio_root_file()))

try(knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()))


```

```{r, message=FALSE}
library(tidyverse)

library(tidyverse)
if(!require(emmeans)){install.packages("emmeans")
  library(emmeans)} #this line installs the package ony if you don't already have it installed
if(!require(car)){install.packages("car")
  library(car)}
```

# Part 1: Tumor Growth

## Data Management

```{r}
# load data
load("/Users/allytirendi/Downloads/tumor_growth.RData", verbose = T)


# create new factor variable
tumor = tumor %>%
  mutate(group_f = factor(Group, levels = c(1,2,3,4),
                          labels = c("control", "drug only","radiation only", "drug + radiation")))

tumor
```

## Descriptive Statistics

```{r}
# summary statistics and visualization
tumor %>%
  drop_na(Size) %>%
  group_by(group_f) %>%
  summarise(n = n(),
            mean = mean(Size),
            median = median(Size),
            max = max(Size),
            min = min(Size),
            q25 = quantile(Size,.25),
            q75 = quantile(Size,.75),
            var = var(Size),
            sd = sd(Size)) %>%
  mutate(IQR = q75-q25,
         range = max - min)

tumor %>%
  drop_na(Size) %>%
  ggplot(aes(x = Size, fill = group_f)) +
  geom_histogram(color = "black", bins = 5) +
  facet_wrap(. ~ group_f, nrow = 4) +
  theme_classic() + 
  labs(title = "Distribution of Tumor Size by treatment group",
       x = "Tumor Size (volume; mm^3)")
  
tumor %>%
  drop_na(Size) %>%
  ggplot(aes(x = group_f, y = Size, color = group_f)) +
  geom_boxplot(alpha = 0.3) +
  theme_bw() +
  geom_jitter(aes(color = group_f), size = 0.75, width = 0.25) +
  labs(title = "Distribution of Tumor Size by treatment group (2)",
       x = NULL,
       y = "Tumor Size (volume; mm^3)") +
  theme(legend.position = "none")
  


```

The groups all have about the same sample size, however since they all have less than 30 in each group, variability in each of the groups will be extremely different. Furthermore, while there is some difference in the means between the first three groups, there is a very noticeable difference in mean tumor size in the drug + radiation group.

## ANOVA

### Null and alternative hypotheses

Null: All treatment group means of tumor size are equal.

Alternative: At least one treatment group mean of tumor size is different.

### Check Conditions

```{r}
# 4 independent groups
#random samples from each treatment group
#roughly normal populations (caution)
#Equal population variances (our assumption)

```


```{r}
# run anova
model <- lm(Size ~ group_f, data = tumor)
anova(model)

```

The p-value from our ANOVA test is 0.003. Since our p-value is less than our significance level of a = 0.05 and our F test statistic is ~5.65, we reject the null hypothesis. In conclusion, we have sufficient evidence that at least one treatment group mean tumor size deviates from the others. There appears to be association between the type of treatment and tumor size.


### post-hoc comparisons

```{r}
# post-hoc comparisons if appropriate
model.emm <- emmeans(model, pairwise ~ group_f, adjust = "none")
model.emm$contrasts

#post-hoc comparisons bonferroni
model.emm.bonf <- emmeans(model, pairwise ~ group_f, adjust = "bonferroni")
model.emm.bonf$contrasts

#simultaneous confidence intervals
model.ci <- confint(model.emm.bonf, adjust = "bonferroni")$emmeans
model.ci

#plot confidence intervals
plot(model.ci, xlab = "Estimated Mean Tumor Size (volume; mm^3)")
```

### Summary

At a significance level of a = 0.05, our first post-hoc pairwise treatment comparisons show the drug + radiation group differed from the other groups with p-values of 0.0006, 0.0085, and 0.0028, indicating they are all statistically significant. We then performed a Bonferroni correction to control any type 1 errors, and saw that the control vs drug + radiation group (p = 0.0038, Bonferroni-adjusted) and the radiation only vs drug + radition (p =  0.0165, Bonferroni-adjusted) were statistically significant. The only one of note that was above 0.05 was the comparison between drug only and drug + radiation (p = 0.0509, Bonferroni-adjusted) indicating this comparison was not statistically significant. Furthermore, by constructing simultaneous confidence intervals we note the drug + radiation group (~681, ~1581) had minimal overlap with the other three groups. Overall, we can conclude the drug + radiation treatment significantly reduced mean tumor size compared to the control and radiation-only groups, and showed the largest observed reduction of tumor size among all groups.



## Kruskal-Wallis


```{r}
# kruskal-wallis test

kruskal.test(Size ~ group_f, data = tumor)
```


The null hypothesis is the distribution of tumor sizes is the same across all treatment groups. The alternative hypothesis is at least one distribution of tumor sizes is different from the other treatment groups. The p-value from the Kruskal- Wallis rank sum test is ~0.023. Since this p-value is less than our significance level of a = 0.05, we reject the null hypothesis. We have sufficient evidence that at least one tumor size treatment group distribution is different. This is in agreement with the results from the one way ANOVA test.

# Part 2: Intubation

## Data Management 


```{r}
# import data
load("/Users/allytirendi/Desktop/school/BIOST 2141/Data/Laryngoscope.RData", verbose = T)

scope = laryngoscope

# filter
scope_f = scope %>%
  filter(attempt1_S_F == 1) %>%
   select(ease,BMI)

scope_f

```

## Descriptive Statistics

```{r}
# summary statistics
scope_f %>%
  drop_na(ease) %>%
  summarise(n_ease = n(),
            mean_ease = mean(ease),
            sd_ease = sd(ease),
            var_ease = var(ease))

scope_f %>%
  drop_na(BMI) %>%
  summarise(n_BMI = n(),
            mean_BMI = mean(BMI),
            sd_BMI = sd(BMI),
            var_BMI = var(BMI))

#Pearson Correlation
cor(scope_f$BMI, scope_f$ease, use = "pairwise.complete.obs")
 

#visualization
scope_f %>%
  drop_na(ease, BMI) %>%
  ggplot(aes(x = BMI, y = ease)) +
  geom_point() +
  theme_bw() +
  labs( y = "Ease of Intubation", x = "BMI")

  

```

From the point graph there seems to be very little correlation between BMI and Ease of Intubation. The calculated correlation between BMI and Ease of Intubation is -0.098, which indicated a very weak negative linear association.



## Linear Regression  

```{r}
# fit model

model_lm = lm(ease ~ BMI, data = scope_f)
summary(model_lm)

#plot

data.frame(residual = model_lm$residuals,
        yhat = model_lm$fitted.values) %>%
  ggplot(aes(x = yhat, y = residual)) +
  geom_point() +
  theme_bw() +
  geom_hline(yintercept = 0) +
  labs(x = "Fitted Values", y = "Residuals")


scope_f %>%
  drop_na(ease,BMI) %>%
  ggplot(aes(x = BMI, y = ease)) +
  geom_point() +
  theme_bw() +
  geom_abline(intercept = model_lm$coefficients[1], slope = model_lm$coefficients[2], color = "lightblue") +
  labs(y = "Ease of Intubation", x = "BMI")
```


### Estimated regression model

Response: Ease(hat) = 62.78 + (-0.53)*BMI


### Slope interpretation

Each 1 unit increase in BMI is associated with a 0.53 point decrease in ease score, suggesting that the higher the BMI, the lower the ease score (easier intubations).

### Hypothesis test

The null hypothesis is B1 = 0, or in other words there is no linear association between BMI and ease of intubation. The alternate hypothesis is B1 does not equal 0, meaning there is a linear association between BMI and ease of intubation. At a significance level of a = 0.05, with a test statistic of -0.907 and a p-value of 0.37, we would fail to reject the null hypothesis and conclude we do not have sufficient evidence that BMI has a linear relationship with the ease of intubation.

### R squared Interpretation

The coefficient of determination was 0.009702, meaning that about 0.97% of the variability in ease of intubation can be explained by the linear relationship with BMI. This indicates that BMI is not a good predictor of the ease of intubation.


### Example 95% CI and prediction Intervals for BMI 35

```{r}
new.dat = data.frame(BMI = 35)

#Confidence Interval
predict(model_lm, newdata = new.dat, interval = 'confidence', level = 0.95)

#Predicition Interval
predict(model_lm, newdata = new.dat, interval = 'prediction', level = 0.95)
```


### Summary

Overall, BMI does not appear to be a good predictor of ease of intubation. The correlation coefficient was -0.09, which indicates an extremely weak negative association between the variables. Furthermore, after conducting a hypothesis test for the slope at a significance level of 0.05, the p-value was 0.37. Since 0.37 >> 0.05, we fail to reject the null hypothesis that there is no significant linear association between BMI and ease of intubation.

# Session Information

```{r}
sessionInfo()
```
